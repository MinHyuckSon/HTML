<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <script  src="http://code.jquery.com/jquery-latest.min.js"></script>
    <title>학생성적표</title>
    <style>
        table,th,td{border:1px solid black; border-collapse: collapse;}
        th,td{width:100px; height:40px; text-align: center; }
    </style>
</head>
<body>
    <form action="#" method="get">
        <label>번호</label>
        <input type="text" id="sno" name="sno" ><br>
        <label>이름</label>
        <input type="text" id="name" name="name"  ><br>
        <label>국어</label>
        <input type="text" id="kor" name="kor" ><br>
        <label>영어</label>
        <input type="text" id="eng" name="eng" ><br>
        <label>수학</label>
        <input type="text" id="math" name="math" onkeyup="enterBtn(event)" ><br>
        <button type="button" id="sbtn" onclick="saveBtn()" >성적저장</button>
        <button type="button" id="cancelBtn" onclick="cancelEdit()" style="display:none;">취소</button>
    </form>
    <table>
        <tr >
            <th>번호</th>
            <th>이름</th>
            <th>국어</th>
            <th>영어</th>
            <th>수학</th>
            <th>합계</th>
            <th>평균</th>
            <th>비고</th>
        </tr>
        <tbody id="tbody">
            <tr id="1">
                <td>1</td>
                <td>홍길동</td>
                <td>100</td>
                <td>100</td>
                <td>100</td>
                <td>300</td>
                <td>100.0</td>
                <td>
                    <button type="button" onclick="updateBtn(this)">수정</button>
                    <button type="button" onclick="deleteBtn(this)">삭제</button>
                </td>
            </tr>
            <tr id="2">
                <td>2</td>
                <td>유관순</td>
                <td>90</td>
                <td>90</td>
                <td>90</td>
                <td>270</td>
                <td>90.0</td>
                <td>
                    <button type="button" onclick="updateBtn(this)">수정</button>
                    <button type="button" onclick="deleteBtn(this)">삭제</button>
                </td>
            </tr>
        </tbody>
    </table>
        <script>
            // 전역 변수 - 수정 모드 관리
            var isEditMode = false;
            var currentEditRow = null;
            // 수정버튼
            function updateBtn(thisBtn){
                alert("수정버튼을 클릭했습니다.");
                var tr_e = thisBtn.parentElement.parentElement;
                var tds = tr_e.querySelectorAll("td");
                // 수정 모드 설정
                isEditMode = true;
                currentEditRow = tr_e;
                // 기존 데이터를 입력 폼에 채우기
                document.querySelector("#sno").value = tds[0].innerText;
                document.querySelector("#name").value = tds[1].innerText;
                document.querySelector("#kor").value = tds[2].innerText;
                document.querySelector("#eng").value = tds[3].innerText;
                document.querySelector("#math").value = tds[4].innerText;
                // 버튼 텍스트 변경
                document.querySelector("#sbtn").innerText = "성적수정";
                document.querySelector("#cancelBtn").style.display = "inline-block";
                // 포커스 이동
                document.querySelector("#sno").focus();
            }
        // 삭제버튼
        function deleteBtn(thisbtn){
            //console.log(thisbtn);
            //console.log(btn.parentElement);
            //console.log(btn.parentElement.parentElement.remove());
            var tr_e = thisbtn.parentElement.parentElement;
            //console.log(tr_e.querySelectorAll("td"));
            //console.log(tr_e.querySelectorAll("td"))[1].innerText;
            var del_name = tr_e.querySelectorAll("td")[1].innerText;
            if(confirm(del_name+"정말 삭제하시겠습니까?")){
                thisbtn.parentElement.parentElement.remove();
            }
        }// deleteBtn
            // 엔터키 이벤트
        function enterBtn(event){
            if(event.keyCode == 13){
                saveBtn();
            }
        } // enterBtn
        // 글자 삭제 함수
        function txt_clear(){
            document.querySelector("#sno").value = '';
            document.querySelector("#name").value = '';
            document.querySelector("#kor").value = '';
            document.querySelector("#eng").value = '';
            document.querySelector("#math").value = '';
        } // txt_clear
        // 수정 취소 함수
        function cancelEdit(){
            if(isEditMode){
                isEditMode = false;
                currentEditRow = null;
                document.querySelector("#sbtn").innerText = "성적저장";
                document.querySelector("#cancelBtn").style.display = "none";
                txt_clear();
                alert("수정이 취소되었습니다.");
            }
        } // cancelEdit
        // 학생 성적 저장
        function saveBtn(){
            var checkNum = document.querySelector("#sbtn").innerText;
            var sno = document.querySelector("#sno").value;
            if(sno.length <=0){
                alert("데이터를 입력하세요.");
                document.querySelector("#sno").focus();
                return;
            } // if
            var name = document.querySelector("#name").value;
            var kor = Number(document.querySelector("#kor").value);
            var eng = Number(document.querySelector("#eng").value);
            var math = Number(document.querySelector("#math").value);
            var total = kor + eng + math;
            var avg = (total / 3).toFixed(1);
            // 수정 모드인지 확인
            if(isEditMode && currentEditRow){
                // 수정 모드: 기존 행 업데이트
                var tds = currentEditRow.querySelectorAll("td");
                tds[0].innerText = sno;
                tds[1].innerText = name;
                tds[2].innerText = kor;
                tds[3].innerText = eng;
                tds[4].innerText = math;
                tds[5].innerText = total;
                tds[6].innerText = avg;
                // ID 업데이트
                currentEditRow.id = sno;
                alert("성적이 수정되었습니다.");
                // 수정 모드 해제
                isEditMode = false;
                currentEditRow = null;
                document.querySelector("#sbtn").innerText = "성적저장";
                document.querySelector("#cancelBtn").style.display = "none";
            } else {
                // 저장 모드: 새로운 행 추가
                var tbody = document.querySelector("#tbody");
                var dhtml = tbody.innerHTML;
                tbody.innerHTML = dhtml + `
                <tr id='${sno}'>
                    <td>${sno}</td>
                    <td>${name}</td>
                    <td>${kor}</td>
                    <td>${eng}</td>
                    <td>${math}</td>
                    <td>${total}</td>
                    <td>${avg}</td>
                    <td>
                        <button type="button" onclick="updateBtn(this)">수정</button>
                        <button type="button" onclick="deleteBtn(this)">삭제</button>
                    </td>
                </tr>
                `;
                alert("성적이 저장되었습니다.");
            }
            txt_clear(); // 글자 삭제 함수 호출
        } // saveBtn
        /*
        document.querySelector("#sbtn").addEventListener("click", function(){
            alert("학생 성적을 저장합니다.");
        });
        */
    </script>
</body>
</html>















